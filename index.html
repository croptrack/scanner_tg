<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Scanner 3000</title>
    <script src="telegram.org"></script>
    <style>
        body { margin: 0; padding: 0; background: #000; color: #f0f; font-family: sans-serif; overflow: hidden; width: 100vw; height: 100vh; }
        #container { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        
        /* –ñ–∏–≤–æ–µ –≤–∏–¥–µ–æ —Å –∫–∞–º–µ—Ä—ã */
        video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; }
        
        /* –•–æ–ª—Å—Ç –¥–ª—è —Å—Ç–æ–ø-–∫–∞–¥—Ä–∞ */
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 5; display: none; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .controls { position: absolute; bottom: 40px; width: 100%; display: flex; justify-content: space-evenly; align-items: center; z-index: 10; }
        
        #shutter { width: 70px; height: 70px; background: rgba(255,255,255,0.3); border: 5px solid #fff; border-radius: 50%; display: flex; justify-content: center; align-items: center; }
        #shutter::after { content: ''; width: 50px; height: 50px; background: #fff; border-radius: 50%; }
        
        #switchBtn { width: 50px; height: 50px; background: rgba(0,0,0,0.5); border: 2px solid #fff; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; color: #fff; cursor: pointer; }

        /* –¢–∞ —Å–∞–º–∞—è –Ω–∞–¥–ø–∏—Å—å */
        #kisaLabel { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 20; padding: 20px; border: 8px solid #f0f; display: none;
            background: rgba(0,0,0,0.8); font-size: 4rem; font-weight: 900;
            color: #f0f; text-align: center; width: 80%; pointer-events: none;
        }
    </style>
</head>
<body>

<div id="container">
    <video id="video" autoplay playsinline muted></video>
    <canvas id="photoCanvas"></canvas>
    <div id="kisaLabel">–ö–ò–°–ê</div>

    <div class="controls" id="ui">
        <div id="switchBtn" onclick="toggleCamera()">üîÑ</div>
        <div id="shutter" onclick="takePhoto()"></div>
        <div style="width: 50px;"></div> <!-- –î–ª—è —Ü–µ–Ω—Ç—Ä–æ–≤–∫–∏ -->
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    const video = document.getElementById('video');
    const canvas = document.getElementById('photoCanvas');
    const kisaLabel = document.getElementById('kisaLabel');
    const ui = document.getElementById('ui');
    let currentStream = null;
    let isFrontCamera = false; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–¥–Ω—è—è

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã
    async function startCamera() {
        if (currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
        }

        const constraints = {
            video: {
                facingMode: isFrontCamera ? "user" : "environment",
                width: { ideal: 1280 },
                height: { ideal: 720 }
            }
        };

        try {
            currentStream = await navigator.mediaDevices.getUserMedia(constraints);
            video.srcObject = currentStream;
        } catch (err) {
            console.error("–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã:", err);
            alert("–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ HTTPS –∏ —Ä–∞–∑—Ä–µ—à–∏–ª–∏ –¥–æ—Å—Ç—É–ø.");
        }
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
    function toggleCamera() {
        isFrontCamera = !isFrontCamera;
        startCamera();
        if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
    }

    // –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ
    function takePhoto() {
        const ctx = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        // –†–∏—Å—É–µ–º –∫–∞–¥—Ä
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫
        if (currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
        }

        video.style.display = 'none';
        ui.style.display = 'none';
        canvas.style.display = 'block';

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–¥–ø–∏—Å—å
        setTimeout(() => {
            kisaLabel.style.display = 'block';
            if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');

            // –ö–Ω–æ–ø–∫–∞ –¢–µ–ª–µ–≥—Ä–∞–º –¥–ª—è —Å–±—Ä–æ—Å–∞
            tg.MainButton.setText("–ó–ê–ù–û–í–û");
            tg.MainButton.show();
            tg.MainButton.onClick(() => location.reload());
        }, 300);
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    startCamera();
</script>
</body>
</html>
