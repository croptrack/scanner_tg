<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Scanner</title>
    <script src="telegram.org"></script>
    <style>
        body { margin: 0; padding: 0; background: #000; color: #f0f; font-family: sans-serif; overflow: hidden; height: 100vh; }
        #container { height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        
        /* Слой с готовым фото */
        #displayPhoto { position: absolute; width: 100%; height: 100%; object-fit: contain; display: none; z-index: 5; }
        
        /* Кнопка */
        .ui { z-index: 10; text-align: center; }
        .btn-box { position: relative; width: 220px; height: 70px; background: #f0f; border-radius: 15px; display: flex; align-items: center; justify-content: center; }
        .btn-box span { color: #000; font-weight: bold; font-size: 1.5rem; }
        #camInput { position: absolute; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

        /* Надпись */
        #kisaLabel { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 20; padding: 20px; border: 8px solid #f0f; display: none;
            background: rgba(0,0,0,0.8); font-size: 4rem; font-weight: 900;
            color: #f0f; text-align: center; width: 80%; pointer-events: none;
        }
    </style>
</head>
<body>

<div id="container">
    <img id="displayPhoto">
    <div id="kisaLabel">КИСА</div>

    <div class="ui" id="controls">
        <div class="btn-box">
            <span>ПОГНАЛИ</span>
            <!-- Основной триггер камеры -->
            <input type="file" accept="image/*" capture="user" id="camInput">
        </div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    const camInput = document.getElementById('camInput');
    const displayPhoto = document.getElementById('displayPhoto');
    const kisaLabel = document.getElementById('kisaLabel');
    const controls = document.getElementById('controls');

    camInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        // 1. Сразу прячем кнопку, чтобы не мешала
        controls.style.display = 'none';

        // 2. Читаем фото
        const reader = new FileReader();
        reader.onload = function(event) {
            // 3. Показываем картинку
            displayPhoto.src = event.target.result;
            displayPhoto.style.display = 'block';

            // 4. Выводим КИСА через полсекунды
            setTimeout(() => {
                kisaLabel.style.display = 'block';
                
                // Тряска телефона
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');

                // Кнопка перезапуска от самого Telegram
                tg.MainButton.setText("ЗАНОВО");
                tg.MainButton.show();
                tg.MainButton.onClick(() => {
                    location.reload();
                });
            }, 500);
        };
        reader.readAsDataURL(file);
    });
</script>
</body>
</html>
